#!/usr/bin/env bash
top_margin=600
bottom_margin=600

# Check if wlogout is already running
if pgrep -x "wlogout" >/dev/null; then
  pkill -x "wlogout"
  exit 0
fi

# Detect monitor resolution and scaling factor
resolution=$(hyprctl -j monitors | jq -r '.[] | select(.focused==true) | .height / .scale' | awk -F'.' '{print $1}')
hypr_scale=$(hyprctl -j monitors | jq -r '.[] | select(.focused==true) | .scale')
height=$(hyprctl -j monitors | jq -r '. [] | select(.focused==true) .height')

wlogout -C "$HOME/.config/wlogout/style.css" \
  -l "$HOME/.config/wlogout/layout" \
  --protocol layer-shell \
  -b 5 \
  -T "$(awk "BEGIN {printf \"%.0f\", $top_margin * $height * $hypr_scale / $resolution}")" \
  -B "$(awk "BEGIN {printf \"%.0f\", $bottom_margin * $height * $hypr_scale / $resolution}")" &
